!function(a){"use strict";"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(a):"undefined"!=typeof module&&module.exports?module.exports=a():window.LazyloadImg=a()}(function(){"use strict";function a(a){this.util={isArray:function(a){return a&&"object"==typeof a&&a.constructor==Array},isString:function(a){return a&&"string"==typeof a&&a.constructor==String},hasOwn:function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},isObject:function(a){return null!==a&&"object"==typeof a},isEmpty:function(a){if(null==a)return!0;if(this.util.isArray(a)||this.util.isString(a))return 0===a.length;for(var b in a)if(this.util.hasOwn(a,b))return!1;return!0}.bind(this),extend:function(a,b){for(var c=Object.keys(b),d=c.length;d--;)a[c[d]]=b[c[d]];return a},warn:function(a){window.console&&this.defaults.debug&&window.console.warn("lazyloadImgï¼š",a)}.bind(this),each:function(a,b){var c,d;if(a)if(c=0,a.length)for(d=a.length;d>c&&b(c,a[c])!==!1;c++);else for(c in a)if(a.hasOwnProperty(c)&&b(c,a[c])===!1)break}},this.defaults={el:"[data-lazy]",top:0,left:0,right:0,bottom:0,duration:100,debug:!0,placeholder:"",selector:document,before:function(){},load:function(){},error:function(){}},this.count=0,this.elements=[],this.dataSrc="lazy",this.monitorEvent=["DOMContentLoaded","load","click","touchstart","touchend","haschange","online","pageshow","popstate","resize","storage","mousewheel","scroll"],this.init=function(){this.util.isEmpty(a)||(this.util.isObject(a)||console.warn("lazyloadImg config must be an object"),this.defaults=this.util.extend(this.defaults,a)),this.dataSrc=this.getSelector(),this.initElementMap(),this.refresh(),this.bind()},this.getSelector=function(){var a=/\[data-([a-z]+)\]$/.exec(this.defaults.el);return this.util.isEmpty(a)?"src":a[1]},this.initElementMap=function(){var a=document.querySelectorAll(this.defaults.el);0!=a.length&&(this.count=0,this.elements=[],this.util.each(a,function(a,b){if(b.getAttribute("data-"+this.dataSrc)){if(this.util.isEmpty(this.defaults.placeholder))return this.util.warn("param placeholder can not be empty "),!1;this.count++,b.getAttribute("data-lazy-id")||b.setAttribute("data-lazy-id",this.count),b.src=this.defaults.placeholder,this.elements.push(b)}}.bind(this)))},this.refresh=function(){return this.initElementMap(),0==this.count?!1:(this.util.each(this.elements,function(a,b){this.checkElementInViewport(b)&&setTimeout(function(){this.loadImg(a,b)}.bind(this),this.defaults.duration)}.bind(this)),void 0)},this.loadImg=function(a,b){var d,c=b.dataset[this.dataSrc];this.util.isEmpty(c)||(d=new Image,d.src=c,this.defaults.before.call(this,b),d.onload=function(){return b.src=d.src,delete b.dataset[this.dataSrc],this.elements.splice(a,1),this.count--,this.defaults.load.call(this,b)}.bind(this),d.onerror=function(){return this.defaults.error.call(this,b)}.bind(this))},this.checkElementInViewport=function(a){var b=a.getBoundingClientRect(),c=a.offsetWidth,d=a.offsetHeight,e=window.innerWidth,f=window.innerHeight,g=!(b.right-this.defaults.left<=0&&b.left+c-this.defaults.left<=0||b.left+this.defaults.right>=e&&b.right+this.defaults.right>=c+e),h=!(b.bottom-this.defaults.top<=0&&b.top+d-this.defaults.top<=0||b.top+this.defaults.bottom>=f&&b.bottom+this.defaults.bottom>=d+f);return 0!=a.width&&0!=a.height&&g&&h},this.bind=function(){var a=this;this.util.each(this.monitorEvent,function(b,c){a.defaults.selector.addEventListener(c,function(){a.refresh()},!1)})},this.unbind=function(){var a=this;this.util.each(this.monitorEvent,function(b,c){a.defaults.selector.removeEventListener(c,function(){a.refresh()})})},this.init()}return a});